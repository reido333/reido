<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Checklist Privado</title>
    <style>
        :root {
            --bg-body: #e9ecef;
            --bg-card: #ffffff;
            --text-main: #333333;
            --text-sub: #666666;
            --border: #dddddd;
            --item-bg: #ffffff;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg-body: #121212;
                --bg-card: #1e1e1e;
                --text-main: #f0f0f0;
                --text-sub: #b0b0b0;
                --border: #333333;
                --item-bg: #252525;
            }
        }

        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg-body); display: flex; justify-content: center; padding: 20px; color: var(--text-main); transition: 0.3s; }
        .container { background: var(--bg-card); padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); width: 100%; max-width: 400px; }
        
        h2 { text-align: center; margin-bottom: 5px; }
        .task-counter { text-align: center; font-size: 0.9em; color: #007bff; margin-bottom: 20px; font-weight: bold; }
        
        .form-group { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
        input[type="text"], input[type="date"] { padding: 12px; border: 1px solid var(--border); border-radius: 6px; font-size: 16px; background: var(--item-bg); color: var(--text-main); }
        
        button { padding: 12px; cursor: pointer; border: none; border-radius: 6px; font-weight: bold; transition: 0.3s; }
        #addBtn { background: #007bff; color: white; }
        #googleLoginBtn { background: #db4437; color: white; margin-bottom: 10px; width: 100%; display: flex; align-items: center; justify-content: center; gap: 10px; }
        #logoutBtn { background: transparent; color: #888; border: 1px solid #888; font-size: 0.8em; padding: 5px 10px; margin-top: 10px; width: 100%; }
        #logoutBtn:hover { color: #f0f0f0; background: #888; }
        
        ul { list-style: none; padding: 0; }
        li { background: var(--item-bg); border-bottom: 1px solid var(--border); padding: 12px; display: flex; align-items: center; gap: 10px; border-radius: 4px; margin-bottom: 5px; }
        
        .task-info { display: flex; align-items: center; gap: 10px; flex: 1; }
        .date-badge { font-size: 0.75em; color: var(--text-sub); background: rgba(0,0,0,0.05); padding: 4px 8px; border-radius: 4px; }
        
        .done span { text-decoration: line-through; opacity: 0.5; }
        .complete-btn { background: none; color: #28a745; font-size: 18px; padding: 0 5px; cursor: pointer; border: none; }
        .complete-btn:hover { color: #218838; transform: scale(1.2); }
        
        #loading { text-align: center; color: var(--text-sub); font-style: italic; }
        .user-info { font-size: 0.8em; color: var(--text-sub); text-align: center; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h2>üìù Meu Checklist</h2>
    <div id="taskCounter" class="task-counter">Carregando...</div>
    
    <div id="loading">Identificando...</div>
    
    <div id="authSection" style="display: none;">
        <button id="googleLoginBtn">Salvar lista no Google</button>
    </div>

    <div id="mainContent" style="display: none;">
        <div id="userInfo" class="user-info"></div>
        <div class="form-group">
            <input type="text" id="taskInput" placeholder="O que precisa ser feito?">
            <input type="date" id="dateInput">
            <button id="addBtn">Adicionar Tarefa</button>
        </div>
        <ul id="taskList"></ul>
        <button id="logoutBtn" style="display: none;">Sair / Trocar Conta</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, where, orderBy, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { getAuth, signInAnonymously, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAL4ySdfSAADCvtcjDUOXPEJVAIFupu9P8",
        authDomain: "reido-f92ee.firebaseapp.com",
        projectId: "reido-f92ee",
        storageBucket: "reido-f92ee.firebasestorage.app",
        messagingSenderId: "168960472442",
        appId: "1:168960472442:web:32d61e9659bb8c043f92c3"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const colRef = collection(db, "tarefas");

    onAuthStateChanged(auth, (user) => {
        const loading = document.getElementById('loading');
        const main = document.getElementById('mainContent');
        const authSec = document.getElementById('authSection');
        const logBtn = document.getElementById('logoutBtn');

        if (user) {
            loading.style.display = 'none';
            main.style.display = 'block';
            authSec.style.display = user.isAnonymous ? 'block' : 'none';
            logBtn.style.display = user.isAnonymous ? 'none' : 'block';
            document.getElementById('userInfo').innerHTML = `Logado como: <b>${user.displayName || 'Convidado'}</b>`;
            startListening(user.uid);
        } else {
            signInAnonymously(auth);
        }
    });

    document.getElementById('googleLoginBtn').onclick = () => signInWithPopup(auth, new GoogleAuthProvider());
    
    document.getElementById('logoutBtn').onclick = () => {
        if(confirm("Deseja sair da conta atual?")) {
            signOut(auth);
        }
    };

    document.getElementById('addBtn').onclick = async () => {
        const text = document.getElementById('taskInput').value;
        const date = document.getElementById('dateInput').value;
        if (text && date) {
            await addDoc(colRef, { text, date, completed: false, userId: auth.currentUser.uid, createdAt: Date.now() });
            document.getElementById('taskInput').value = '';
        }
    };

    function startListening(uid) {
        const q = query(colRef, where("userId", "==", uid), orderBy("date", "asc"));
        onSnapshot(q, (snap) => {
            const list = document.getElementById('taskList');
            list.innerHTML = '';
            let pendingCount = 0;

            snap.forEach(d => {
                const t = d.data();
                if (!t.completed) pendingCount++;

                const li = document.createElement('li');
                if (t.completed) li.classList.add('done');
                li.innerHTML = `
                    <div class="task-info">
                        <input type="checkbox" ${t.completed ? 'checked' : ''} id="check-${d.id}">
                        <span>${t.text}</span>
                    </div>
                    <span class="date-badge">${t.date.split('-').reverse().join('/')}</span>
                    <button class="complete-btn" id="del-${d.id}">‚úî</button>
                `;
                list.appendChild(li);

                document.getElementById(`check-${d.id}`).onclick = () => updateDoc(doc(db, "tarefas", d.id), { completed: !t.completed });
                document.getElementById(`del-${d.id}`).onclick = () => { if(confirm('conclu√≠da?')) deleteDoc(doc(db, "tarefas", d.id)); };
            });

            document.getElementById('taskCounter').innerText = pendingCount === 0 ? "üéâ Tudo pronto!" : `‚è≥ ${pendingCount} pendente(s)`;
        });
    }
</script>
</body>
</html>
